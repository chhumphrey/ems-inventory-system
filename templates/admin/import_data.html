{% extends "base.html" %}

{% block title %}Import Data - Admin{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">
                        <i class="fas fa-upload me-2"></i>
                        Import Data from Local Environment
                    </h4>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <h5><i class="fas fa-info-circle me-2"></i>Data Import Instructions</h5>
                        <p class="mb-0">
                            This tool allows you to import your exported data from the local development environment 
                            into your production system. The data files should be available in the <code>data_export/</code> 
                            folder on the server.
                        </p>
                    </div>

                    {% if data_files_exist %}
                    <div class="alert alert-success">
                        <h5><i class="fas fa-check-circle me-2"></i>Data Files Found</h5>
                        <p class="mb-0">All required data files are available and ready for import.</p>
                    </div>
                    {% else %}
                    <div class="alert alert-warning">
                        <h5><i class="fas fa-exclamation-triangle me-2"></i>Data Files Not Found</h5>
                        <p class="mb-0">
                            The required data files are not available. Please ensure the <code>data_export/</code> 
                            folder has been deployed to the server.
                        </p>
                    </div>
                    {% endif %}

                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-secondary text-white">
                                    <h5 class="mb-0">Import Options</h5>
                                </div>
                                <div class="card-body">
                                    <form method="POST">
                                        <div class="mb-3">
                                            <label for="import_type" class="form-label">Select Import Type:</label>
                                            <select class="form-select" id="import_type" name="import_type" required>
                                                <option value="">Choose import type...</option>
                                                <option value="all">Import All Data (Recommended)</option>
                                                <option value="users">Import Users Only</option>
                                                <option value="locations">Import Locations Only</option>
                                                <option value="items">Import Items Only</option>
                                                <option value="inventories">Import Inventory Counts Only</option>
                                                <option value="inventory_items">Import Inventory Items Only</option>
                                            </select>
                                        </div>
                                        
                                        <button type="submit" class="btn btn-primary" id="importBtn">
                                            <i class="fas fa-upload me-2"></i>
                                            Start Import
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-info text-white">
                                    <h5 class="mb-0">Import Summary</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-6">
                                            <div class="text-center">
                                                <h3 class="text-primary">{{ summary.total_users or 0 }}</h3>
                                                <small class="text-muted">Users</small>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="text-center">
                                                <h3 class="text-success">{{ summary.total_locations or 0 }}</h3>
                                                <small class="text-muted">Locations</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-6">
                                            <div class="text-center">
                                                <h3 class="text-warning">{{ summary.total_items or 0 }}</h3>
                                                <small class="text-muted">Items</small>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="text-center">
                                                <h3 class="text-info">{{ summary.total_inventories or 0 }}</h3>
                                                <small class="text-muted">Inventories</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header bg-warning text-dark">
                                    <h5 class="mb-0">
                                        <i class="fas fa-exclamation-triangle me-2"></i>
                                        Important Notes
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <ul class="list-unstyled mb-0">
                                        <li class="mb-2">
                                            <i class="fas fa-check text-success me-2"></i>
                                            <strong>Users:</strong> Will be imported with default password <code>changeme123</code>
                                        </li>
                                        <li class="mb-2">
                                            <i class="fas fa-check text-success me-2"></i>
                                            <strong>Locations:</strong> All location definitions will be imported
                                        </li>
                                        <li class="mb-2">
                                            <i class="fas fa-check text-success me-2"></i>
                                            <strong>Items:</strong> All item configurations and thresholds will be imported
                                        </li>
                                        <li class="mb-2">
                                            <i class="fas fa-check text-success me-2"></i>
                                            <strong>Inventories:</strong> All inventory counts and dates will be imported
                                        </li>
                                        <li class="mb-2">
                                            <i class="fas fa-check text-success me-2"></i>
                                            <strong>Inventory Items:</strong> All item quantities, expiration dates, and sections will be imported
                                        </li>
                                    </ul>
                                    
                                    <div class="alert alert-warning mt-3">
                                        <strong>Security Reminder:</strong> After import, immediately change all user passwords 
                                        from the default <code>changeme123</code> to secure passwords.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const importBtn = document.getElementById('importBtn');
    const importType = document.getElementById('import_type');
    
    importBtn.addEventListener('click', function(e) {
        if (!importType.value) {
            e.preventDefault();
            alert('Please select an import type.');
            return;
        }
        
        if (importType.value === 'all') {
            if (!confirm('This will import ALL data (users, locations, and items). Are you sure you want to continue?')) {
                e.preventDefault();
                return;
            }
        }
        
        // Show loading state
        importBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Importing...';
        importBtn.disabled = true;
    });
});
</script>
{% endblock %}
